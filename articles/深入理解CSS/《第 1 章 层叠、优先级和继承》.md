# 第1章 层叠、优先级和继承

## 1.1 层叠

层叠的规则：

* （1）样式表来源：样式是从哪里来的，包括你的样式和浏览器默认的样式
* （2）选择器优先级
* （3）源码顺序：样式在样式表里的声明顺序。

### 1.1.1 样式表的来源

样式表来源有3个：作者样式表、用户样式表、用户代理样式表（浏览器默认样式）

优先级：作者样式表 > 用户样式表 > 用户代理样式表


#### !important

标记了 !important 的声明会被当作更高优先级。


### 1.1.2 选择器优先级 （重点）

CSS选择器的优先级是：**内联 > ID选择器 > 类选择器 > 标签选择器**

具体的计算规则如下：

优先级由 A、B、C、D 的值来决定。其中， 

* A 的值等于 1 的前提是存在内联样式，否则 A = 0；
* B 的值等于 ID 选择器出现的次数；
* C 的值等于 类选择器、属性选择器和伪类出现的总次数；
* D 的值等于 标签选择器和伪元素出现的总次数。

比如下面的选择器

```
//选择器1
ul ol li .red {

}
```

由于选择器1不存在内联样式，所以 A = 0；不存在 id选择器，因此 B = 0；存在一个类选择器，因此 C = 1；存在3个标签选择器，因此 D = 3，那么最终权重计算结果为：{0, 0, 1, 3}。

```
//选择器2
#red {

}
```

选择器2的权重计算结果为：{0, 1, 0, 0}。

我们比较优先级的方法是从A到D依次一一比较值的大小（A、B、C、D权重从左到右依次减小），直到比较出最大值，即可停止。比如选择器2的B值与选择器1的B值相比，1>0，接下来就不需要比较了，选择器2的优先级更高。


### 1.1.3 源码顺序

如果两个声明的来源和优先级相同，其中一个声明在样式表中出现较晚，或者位于页面较晚引入的样式表中，则该声明胜出。

#### 链接样式和源码顺序

```
a:link {
  color: blue;
  text-decoration: none;
}

a:visited {
  color: purple;
}

a:hover {
  text-decoration: underline;
}

a:active {
  color: red;
}
```

书写顺序之所以很重要，是因为层叠。优先级相同时，后出现的样式会覆盖先出现的样式。如果一个元素同时处于两个或者更多状态，最后一个状态就能覆盖其他状态。如果用户将鼠标悬停在一个访问过的链接上，悬停效果会生效。如果用户在鼠标悬停时激活了链接（即点击了它），激活的样式会生效。

这个顺序的记忆口诀是“LoVe/HAte”（“爱/恨”），即link（链接）、visited（访问）、hover（悬停）、active（激活）。注意，如果将一个选择器的优先级改得跟其他的选择器不一样，这个规则就会遭到破坏，可能会带来意想不到的结果。

### 1.1.4 经验法则

* （1）在选择器中不要使用ID。就算只用一个ID，也会大幅提升优先级。当需要覆盖这个选择器时，通常找不到另一个有意义的ID，于是就会复制原来的选择器，然后加上另一个类，让它区别于想要覆盖的选择器。
* （2）不要使用！important。它比ID更难覆盖，一旦用了它，想要覆盖原先的声明，就需要再加上一个！important，而且依然要处理优先级的问题。
* （3）强烈建议尽量不要在JavaScript里使用行内样式。正确的做法是在包里包含一个样式表。如果组件需要频繁修改样式，通常最好用JavaScript给元素添加或者移除类。这样用户就可以在使用这份样式表的同时，在不引入优先级竞赛的前提下，按照自己的喜好选择编辑其中的样式。

